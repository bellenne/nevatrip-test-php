# Тестовое задание Неватрип

## Стек
nginx + php + mysql + phpmyadmin + Docker
### Дополнительно
Дополнительно я использую самописный класс для упращения работы с БД. Данный класс представляет собой обёртку для PHP PDO и реализует основные функции CRUD.
#### Запуск
* Запустить Docker Image, при необходимости настроить **docker-compose.yml**
* Далее необходимо создать пользователя для базы данных, в CMD подключаемся к контейнеру `docker exec -it tools_php-mysql sh`
* Подключаемся к MySQL `mysql -uroot -p` пароль по умолчанию: **s123123**
* Создадим базу данных `CREATE DATABASE 'test_db';` Или то как вы назвали базу данных в **docker-compose.yml**
* Создадим пользователя `CREATE USER 'user1'@'%' IDENTIFIED BY 's123';` user1 и s123 - значения по умолчанию, если меняли в **docker-compose.yml** так же меняем на то, что указали
* Добавим пользователю все права на базу созданную ранее `RANT ALL PRIVILEGES ON 'test_db' . * TO 'user1'@'%';`

После настройки пользователя для БД, можно переходить на страницу ***localhost*** вас встретит приветственная страница и ссылка по переходу на которую, скрипт автоматически проверит наличее БД, создаст в ней необходимые таблицы и заполнит их данными для теста.

## Пояснения по реализации
### Задание №2 Часть 1.
Сильные изменения таблицы заказов произошли т.к. её было необходимо привести к реляционному типу, т.к. нам необходимо учитывать, что типов билетов может несколько видов, то ячейки **ticket_adult_quantity**, **ticket_kid_quantity** для этого нем не подходят, по этому создаём новую таблицу **tickets_type** в которую и заносим все типы билетов. При этом у каждого типа билета своя стоимость на эвенте по этому ячейки **ticket_adult_price**, **ticket_kid_price** так же убираем из таблицы заказов и переностим в отдельную таблицу **events_price** в которой добавляем необходимые типы билетов для эвента.
Вместо этих 4х ячеек мы добавляем 1 новую ячейку **tickets_quantity** в которой храним общее количество билетов.
Так же я заменил ячейку **event_date** на **event_date_id** для того, чтобы было более удобно хранить даты в вермя эвентов и для более удобного их получения при запросе с фронта.

### Задание №2 Часть 2.
Так как по заданию, необходимо хранить баркоды для каждого билета, то ячейка **barcode** в таблице заказов больше не актуальна, по этому я её убираю и создаю новую таблицу **tickets** в которой и буду сохранять все билеты для определённого заказа со своим баркодом. 

#### Комментарий
Реализовано при условии, что у нас имеется возможность измененить код в API

## Вид таблиц
Таблица изменена под дополнительные требования, приведена к реляционному типу.
Введены новые таблицы: tickets_type, event_dates, events_price, tickets. А так же переработана таблица заказов.

Таблица tickets_type:
|         Ключ         | Описание                                                        |
|----------------------|-----------------------------------------------------------------|
| id	               | Идентификатор                                                   |
| ticket_name          | Название билета на английском                                   |

Таблица event_dates:
|         Ключ         | Описание                                                        |
|----------------------|-----------------------------------------------------------------|
| id	               | Идентификатор                                                   |
| event_id             | Идентификатор эвента для которого задаём цену                   |
| date                 | Дата и время проведения эвента                                  |

Таблица events_price:
|         Ключ         | Описание                                                        |
|----------------------|-----------------------------------------------------------------|
| id	               | Идентификатор                                                   |
| event_id             | Идентификатор эвента для которого задаём цену                   |
| ticket_type_id       | Идентификатор типа билета                                       |
| price                | Цена билета для мероприятия                                     |

Таблица tickets:
|         Ключ         | Описание                                                        |
|----------------------|-----------------------------------------------------------------|
| id	               | Идентификатор                                                   |
| order_id             | Идентификатор добавленного заказа                               |
| ticket_type_id       | Идентификатор типа билета                                       |
| barcode              | Штрихкод билета                                                 |

Таблица orders:
|         Ключ         | Описание                                                        |
|----------------------|-----------------------------------------------------------------|
| id	               | Идентификатор                                                   |
| user_id              | Идентификатор пользователя                                      |
| event_id             | Идентификатор эвента                                            |
| event_date_id        | Идентификатор даты и времени эвента                             |
| tickets_quantity     | Общее количество билетов                                        |
| equal_price          | Общая сумма билетов                                             |
| created              | Дата и время занесения заказа                                   |

В связи с расширением функционала изначального задания, а именно добавления новых типов и хранения баркодов для каждого билета, необходимо изменить передаваемые данные на API в функции **book**, предлагаю следующее:

```{
    "event_id": 3,
    "event_date": "2024-11-02 22:00:00",
    "tickets": {
        "adult": {
            "quantity": 2,
            "price": "700",
            "barcode": "5817329758268"
        },
        "preferential": {
            "quantity": 1,
            "price": "500",
            "barcode": "9339789624274"
        }
    },
    "tickets_quantity": 3,
    "equal_price": 1200
}```

Так же небходимо изменить принимаемые значения в API в функции **aprove** на массив, или же отправлять баркоды билетов по одному используя перебор массива.

